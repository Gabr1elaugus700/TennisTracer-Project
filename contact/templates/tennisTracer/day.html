{% extends 'global/base.html' %} {% load static %} {% block content %}
  <main class="content">
    <div class="day">
      <div class="pagination-left">
        {% if page_obj.has_previous %}
          <a href="?page={{ page_obj.previous_page_number }}">&#9664;</a>
        {% else %}
          <span class="disabled">&#9664;</span>
        {% endif %}
      </div>
      <div class="nameDay">
        {% if page_obj %}
          <h1>{{ page_obj.object_list.0.day }}</h1>
        {% endif %}
      </div>
      <div class="pagination-right">
        {% if page_obj.has_next %}
          <a href="?page={{ page_obj.next_page_number }}">&#9654;</a>
        {% else %}
          <span class="disabled">&#9654;</span>
        {% endif %}
      </div>
    </div>
    <div class="contentAula">
      {% for day in page_obj %}
        <div class="aula-Hora">
          <div class="card">
            <h1 class="title">{{ day.hora_ini }}</h1>
            <div class="aluno-Card">
              {% for person in day.aluno_aula_set.all %}
                <div class="aluno-Foto">
                  {% if person.aluno.picture %}
                    <img src="{{ person.aluno.picture.url }}" alt="{{ aluno.first_name }} {{ aluno.last_name }}" onerror="this.onerror=null; this.src='{{ MEDIA_URL }}pictures/defaults/default.png';" />
                  {% else %}
                    <!-- Adicione isso para ver o que está sendo renderizado -->
                    <img src="{{ MEDIA_URL }}pictures/defaults/default.png" alt="AAAA" />
                  {% endif %}
                  <div class="aluno-Nome">{{ person.aluno.last_name }}</div>
                </div>
              {% empty %}
                <p>Nenhum aluno inscrito nesta aula.</p>
              {% endfor %}
            </div>
            <div class="button">
              <button class="button-Card" onclick="openModal({{ day.id }}, '{{ day.hora_ini }}', '{{ day.day }}')">Adicionar Aluno</button>
             
              <button class="button-Card" onclick="FechaAula()">Finalizar Aula</button>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
    {% comment %} MODAL DE ADD ALUNO {% endcomment %}
    <div id="myModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <input type="hidden" id="aulaId" value="" />
        <h2 id="modalTitle" class="title">Adicionar Aluno à Aula</h2>
        <h5 class="subtitle">Escolha o Aluno</h5>

        <div class="alunos-modal">
          {% for aluno in alunos %}
            <a href="#" class="aluno-modal-one" onclick="vincularAluno({{ aluno.id }})">
              <div class="aluno-Foto-Modal">
                {% if aluno.picture %}
                  <img src="{{ aluno.picture.url }}" alt="{{ aluno.first_name }} {{ aluno.last_name }}" onerror="this.onerror=null; this.src='{{ MEDIA_URL }}pictures/defaults/default.png';" />
                {% else %}
                  <!-- Adicione isso para ver o que está sendo renderizado -->
                  <img src="{{ MEDIA_URL }}pictures/defaults/default.png" alt="AAAA" />
                {% endif %}
              </div>
              <div class="aluno-modal-one-name">
                {{ aluno.first_name }} <br />
                {{ aluno.last_name }}
              </div>
            </a>
          {% endfor %}
        </div>
      </div>
    </div>

    {% comment %} MODAL DE FINALIZAR A AULA {% endcomment %}
    <div id="FechaAula" class="modal">
        <div class="modal-content">
          <span class="close" onclick="FechaAula()"></span>
          <input type="hidden" id="FechaAulaIn" value="" />
          {% comment %} <h2 id="modalTitle" class="title">Adicionar Aluno à Aula</h2>
          <h5 class="subtitle">Escolha o Aluno</h5> {% endcomment %}
  
          <div class="alunos-modal">
            <h1>Teste Modal</h1>
          </div>
        </div>
      </div>
  </main>

  <script>
    
    function openModal(id, hora_ini, day) {
      document.getElementById('myModal').style.display = 'block'
    
      document.getElementById('modalTitle').innerText = 'Adicionar Aluno à Aula ' + day + ' às ' + hora_ini
      document.getElementById('aulaId').value = id
    }
    function closeModal() {
      document.getElementById('myModal').style.display = 'none'
    }
    
    function FechaAula() {
        document.getElementById('FechaAula').style.display = 'block'
      
        
      }
      
    function vincularAluno(alunoId) {
      var aulaId = document.getElementById('aulaId').value
    
      // Configurar os dados para enviar
      var data = {
        aula_id: aulaId,
        aluno_id: alunoId
      }
    
      // Enviar a requisição POST
      fetch('/tennisTracer/vinAluno/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': '{{ csrf_token }}' // Inclua o CSRF token
        },
        body: JSON.stringify(data)
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.status === 'success') {
            // Exibir mensagem de sucesso
            alert('Aluno vinculado com sucesso!')
            // Fechar o modal e recarregar a página ou redirecionar
            closeModal()
            window.location.href = '/tennisTracer/'
          } else if (data.status === 'duplicate') {
            alert('Este aluno já está vinculado a esta aula.')
          } else {
            alert('Erro ao vincular aluno.')
          }
        })
        .catch((error) => console.error('Erro:', error))
    }
  </script>
{% endblock %}
